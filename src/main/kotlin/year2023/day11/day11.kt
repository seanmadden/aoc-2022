package year2023.day11

import java.awt.Point
import java.awt.geom.Point2D
import kotlin.math.abs

val testInput = """
    ...#......
    .......#..
    #.........
    ..........
    ......#...
    .#........
    .........#
    ..........
    .......#..
    #...#.....
""".trimIndent()

val puzzleInput = """
    ......#.....#.........................#...........#..........#.....#.......#..............#.................................................
    .....................#....................................................................................#........#........#.......#.......
    .........................................................#............................#..................................................#..
    .........................#.......#..............................#............................#.................#............................
    ..................#...................................................................................#.....................................
    ...........................................#....................................#.................................................#.........
    ...........................................................#..........#..........................#..........................................
    ............#...............#..............................................................#................................................
    ...#.................#.............................................................................................#........................
    ........#..........................#.................#....................#.................................................................
    .................#............................#..................................#..................#...........................#...........
    ........................................#.................#............................#...................#...............................#
    ...............................#..................#..................................................................................#......
    ..............#.........#...................................................................................................................
    ......................................................#....................................#.....#....................#.....................
    #..................#........#.............#......................#.................#.....................#.....................#............
    ............................................................................................................................................
    ........#....................................................................................................#......................#.....#.
    ................................#............#...............#...........#............#.....................................................
    .................................................................................................................#..........................
    ................#..........................................................................#................................................
    .....................#.................#..........#............................#.............................................#..............
    ......#................................................#....................................................................................
    ...................................#................................#..................#............#.........#........................#....
    ..........................................#.................................................................................................
    ............................................................................................#.........................#.....................
    .............................#..............................................................................................................
    #...............#......#.................................#..........................#.............................#.........................
    .................................#.......................................................................#...................#..............
    ....#.....................................................................#....................#..........................................#.
    ............................................#.........#..........................#...............................................#..........
    ............................................................................................................................................
    .........................#....................................#........................................#................#...................
    .......#...........................#..................................................#.....#...............................................
    .................................................................................................................#...................#......
    .............#...............................................................#..................#...........................#...............
    ..................#.........................................................................................................................
    .........#............................#........#.........#.........#................................................#...................#...
    ............................................................................................................................................
    ......................#..................................................................................#.......................#..........
    ...........................................................................#........#............#..........................................
    ............#..............#.........................................#......................................................................
    .....#............#.................................#......................................#...............................#...............#
    ............................................................................................................................................
    #.........................................#.................................................................................................
    ........................#..........#...........#..............#...................................#.........................................
    ........................................................#..........................#.......................#....................#...........
    ...........................................................................#................................................................
    ..#....................................#...........................#...................#....................................................
    .......#............................................#................................................................#......................
    ..............#............#...............................................................#..................#.............................
    ......................................................................#.........#....................................................#......
    ............................................................................................................................................
    ..........#..........#.........................#............#...........................#........#..........................................
    ...........................................................................#............................#....................#...........#..
    .............................#..................................................................................#...........................
    ..........................................#.................................................................................................
    .....#..........#................#..................................................#......#.............................#......#...........
    ............................................................................................................................................
    .#.........#..............#..................#........#..........#.....................................#....................................
    ........................................#.....................................................#..........................................#..
    ..............................#...........................................#................................#.........#......................
    ............................................................................................................................................
    ............................................................................................................................................
    ......#...........................#.................#...........................#.......................#................#.............#....
    ..........................#.............................................#...................................................................
    ................................................................#...........................................................................
    ........................................#...............#.............................#.....#......................................#........
    ......................#...........................................................................#..............#..........................
    ..................................................#.........#......#...........................................................#........#...
    ..#..............#..........................#................................#.....#........................................................
    ............................................................................................................................................
    ....................................#.................................#........................#.......#......#..........#..................
    .......#...............................................................................#...................................................#
    ...............#.......................................#........................................................................#...........
    ...........................................#................................................................................................
    .......................#..............#............................................#................................................#.......
    ............................................................................................................................................
    .#..........................#............................#..................................#..........#......#.............................
    ............................................................................................................................................
    ............................................................................................................................................
    ............#......#.....#.......................#...............................................#..........................................
    ..........................................................................................#..............#..................................
    .....................................................................#............................................#.........................
    ................................................................................#.........................................#.................
    ....#..........#..................................................................................................................#.....#...
    ........................................................#...................................#......#........................................
    ........#...........#......#......................#.....................#............#......................................................
    ...................................#..............................#...........................................................#.............
    .................................................................................................................#..........................
    .........................................#............#....................#..................#......................................#......
    ........................#.....................#...........................................................................................#.
    ...................................................................................................#.....#..................................
    ............................................................................................................................................
    .....................................#...................#...............................................................#.....#............
    .....................#........................................#.......................#.....................................................
    .............#............#.....#...........................................#......................................................#.......#
    .......#...................................................................................#..............#.................................
    #.......................................#.............................#.............................................#.......................
    ...................................#............................#..............................#......................................#.....
    ..............................................................................................................#.............#...............
    ........................................................................................#..........#........................................
    ...............#..........................#..............#..........#.......................................................................
    ......#..................................................................#.......................................#.................#........
    ................................................#...........................................................#.................#.............
    #...................#........#...................................................................#..........................................
    ............................................#...................................#...........#.......................#.......................
    ........#...................................................................................................................................
    .....................................#............#.........#......#................................................................#.......
    .................#....................................................................#..............#......................................
    ................................................................................................#.........................#.................
    ...........................#..............#.................................................................................................
    ..........#.................................................................................................................................
    ................................................#.......#...........................#........#....................#................#........
    .......................................#.........................#..................................#......#................................
    ..................................#.................#....................................#.................................#...............#
    ...........................................#................................................................................................
    ......#.....................................................................................................................................
    ......................#.......#......................................#......#...............................................................
    ................................................#......#...............................................................#................#...
    ..............#................................................................................#.............................#..............
    ..........................................#.............................#........................................#..........................
    .........................#...........................................................................#..............................#.......
    ....................................#.......................................................................................................
    ....#...............#..............................................#....................#...........................#.......................
    ..........................................................#.................................................................................
    ..........................................................................#.......................#.........................................
    ..............#.............................................................................................#...................#.........#.
    .......................#.....................#.......................#............................................#.........................
    ...............................#...................................................#........................................................
    .................#......................................................................#............................................#......
    .......#...................................................#................#........................#..................#...................
    .#...........#..............#...............................................................................................................
    .....................#............................#.................#............#..............#...........................................
    ...........................................#...........#.................#.................................#................................
    ...............................#......................................................#....................................................#
    .............................................................................#..............................................................
    .................................................................................................................................#..........
    .......................#...........#..........#............#.....#........................#.............................................#...
    .#..........#...............#......................................................#......................#......#..........................
""".trimIndent()

val part2TestInput = """
""".trimIndent()

val test2Input = """
""".trimIndent()

fun part1() {
}

fun part2(values: List<Long>) {
}

fun MutableList<StringBuilder>.transpose(): MutableList<StringBuilder> {
    val transposedUniverse = mutableListOf<StringBuilder>()

    for (line in this) {
        transposedUniverse.add(StringBuilder(" ".repeat(this.size)))
    }
    for ((idx, line) in this.withIndex()) {
        for ((jdx, char) in line.withIndex()) {
            transposedUniverse[jdx].setCharAt(idx, char)
        }
    }

    return transposedUniverse
}

fun Point2D.moveTo(otherPoint: Point2D): Int {
    return (abs(x - otherPoint.x) + abs(y - otherPoint.y)).toInt()
}

fun main(args: Array<String>) {
    val universe = mutableListOf<StringBuilder>()

    val galaxySet = mutableListOf<Point2D>()
    for ((idx, line) in puzzleInput.lines().withIndex()) {
        val currentLine = StringBuilder()

        for ((jdx, char) in line.withIndex()) {
            if (char == '#') {
                println("Galaxy found at $idx, $jdx")
                galaxySet.add(Point(idx, jdx))
            }
            currentLine.append(char)
        }
        universe.add(currentLine)
    }

    val transposedUniverse = universe.transpose()

    val offsetGalaxySet = mutableListOf<Point2D>()
    for ((idx, galaxy) in galaxySet.withIndex()) {
        // count empty rows above
        val xOffset = if (galaxy.x > 0) {
            universe.subList(0, galaxy.x.toInt()).count { !it.contains('#') }
        } else 0

        //count empty rows to the left
        val yOffset = if (galaxy.y > 0) {
            transposedUniverse.subList(0, galaxy.y.toInt()).count { !it.contains('#') }
        } else 0

        println("galaxy ${idx + 1} at (${galaxy.x}, ${galaxy.y}) has $xOffset empty rows to the left, and $xOffset empty rows above it")
        val newX = galaxy.x.toInt() + ((xOffset * (1_000_000 - 1)))
        val newY = galaxy.y.toInt() + ((yOffset * (1_000_000 - 1)))
        println("galaxy ${idx + 1} new location (${newX},$newY)")
        offsetGalaxySet.add(Point(newX, newY))
    }

    val distances = mutableListOf<Int>()
    for ((idx, firstPoint) in offsetGalaxySet.withIndex()) {
        for ((jdx, secondPoint) in offsetGalaxySet.subList(idx, offsetGalaxySet.size).withIndex()) {
            println("Distance between points ${idx + 1} and ${jdx + idx + 1} is ${firstPoint.moveTo(secondPoint)}")
            distances.add(firstPoint.moveTo(secondPoint))
        }
    }

    println("Sum of all distances ${distances.fold(0L) { acc, it -> acc + it.toLong()}}")

    val startTime = System.currentTimeMillis()

    val endTime = System.currentTimeMillis()
    println("millis elapsed ${endTime - startTime}")
}
